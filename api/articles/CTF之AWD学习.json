{"title":"CTF之AWD学习","uid":"38fa6375660c17bc3d17395c4f749364","slug":"CTF之AWD学习","date":"2020-09-29T12:12:16.000Z","updated":"2021-06-17T02:54:10.418Z","comments":true,"path":"api/articles/CTF之AWD学习.json","keywords":"A1andNS","cover":[],"content":"<h2 id=\"AWD\"><a href=\"#AWD\" class=\"headerlink\" title=\"AWD\"></a>AWD</h2><p>AWD(Attack With Defence),一种CTF赛制</p>\n<p>三个特点:</p>\n<ol>\n<li>实战性:真实网络安全防护设备设施加入抽象的网络环境中,模拟政企典型网络结构</li>\n<li>对抗性:一种人人对抗的竞赛方式,考验参赛团队攻防兼备.</li>\n<li>实时性:12-48小时不等,靶机数量根据比赛而定,其实时间也是根据赛事举办方而定</li>\n</ol>\n<h2 id=\"AWD环境\"><a href=\"#AWD环境\" class=\"headerlink\" title=\"AWD环境\"></a>AWD环境</h2><ul>\n<li><p>同样的环境主机,相同的起始分数.</p>\n</li>\n<li><p>挖掘漏洞并且攻击对手服务以取得flag来获取分数,被攻击方会被扣分</p>\n</li>\n<li><p>修补自身服务漏洞来避免丢分.</p>\n</li>\n<li><p>每一轮只有一个flag,每过一轮就会进行更新flag.</p>\n</li>\n<li><p>一般安排一个人做防御,两个人做攻击.</p>\n</li>\n</ul>\n<h2 id=\"AWD题目类型\"><a href=\"#AWD题目类型\" class=\"headerlink\" title=\"AWD题目类型\"></a>AWD题目类型</h2><ol>\n<li>sql居多</li>\n<li>文件包含</li>\n<li>各种RCE</li>\n<li>文件上传</li>\n<li>一些常见或不常见CMS框架漏洞</li>\n</ol>\n<h2 id=\"AWD常用工具\"><a href=\"#AWD常用工具\" class=\"headerlink\" title=\"AWD常用工具:\"></a>AWD常用工具:</h2><p>burpsuite, sqlmap, Nmap, masscan, 御剑, dirsearch, wpscan, nc, D盾, seay, Rips, 安全狗, MobaXterm, Xshell, Xftp, 菜刀或蚁剑, chrome, firefox, 还有浏览器各种插件, hackbar, kali,Python各类库或包</p>\n<p>可以提前准备一些CMS的poc或exp(phpwin , phpcms, dz)</p>\n<p>还有各种自动化脚本的模板.</p>\n<p>一句话木马要准备:php,asp,aspx,jsp,内存马</p>\n<h2 id=\"攻击思路\"><a href=\"#攻击思路\" class=\"headerlink\" title=\"攻击思路\"></a>攻击思路</h2><p><img src=\"/home/a1andns/.config/Typora/typora-user-images/image-20200929204026353.png\" alt=\"image-20200929204026353\"></p>\n<p>ssh登上就改密码,防止弱口令被利用.上WAF,注意不要让服务宕机,不然主办方check会扣分,修改mysql弱口令要注意网站配置文件同步修改,重启apache服务以生效.寻找有没有预留后门,可以直接拿flag和上传木马.可以把木马搞成隐藏文件来,提高隐蔽性.</p>\n<ol>\n<li>备份源码</li>\n</ol>\n<p>备份源码,并且利用seay或D盾来进行审计</p>\n<ol start=\"2\">\n<li>信息搜集</li>\n<li>上waf</li>\n</ol>\n<p>一些参考资料:</p>\n<p>AWD攻防赛之各类漏洞FIX方案</p>\n<p><a href=\"https://www.freebuf.com/articles/web/208778.html\">https://www.freebuf.com/articles/web/208778.html</a></p>\n<h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\">#准备工作</span>\n<span class=\"token comment\">#启动sshd服务(Windows端，设置-应用-可选功能-添加openssh客户端+服务端)，服务中开启opensshd服务。</span>\n<span class=\"token function\">ssh</span> <span class=\"token operator\">&lt;</span>-p 端口<span class=\"token operator\">></span> 用户名@IP\n<span class=\"token function\">scp</span> 文件路径 用户名@IP:存放路径\n<span class=\"token comment\">#示例</span>\n<span class=\"token function\">scp</span> -r /var/www/html A1andNS@192.168.3.10:/f:/html/\n<span class=\"token function\">tar</span> -zcvf web.tar.gz /var/www/html/\n<span class=\"token function\">pkill</span> -kill -t <span class=\"token operator\">&lt;</span>用户tty<span class=\"token operator\">></span>\n<span class=\"token function\">ps</span> aux <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> pid或者进程名\n<span class=\"token comment\">#查看已建立连接的网络连接和进程</span>\n<span class=\"token function\">netstat</span> -antulp <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> EST\n<span class=\"token comment\">#查看指定端口被哪个进程占用</span>\n<span class=\"token function\">lsof</span> -i:端口号 或者netstat -tunlp<span class=\"token operator\">|</span><span class=\"token function\">grep</span> 端口号\n<span class=\"token comment\">#结束进程命令</span>\n<span class=\"token function\">kill</span> PID\n<span class=\"token function\">killall</span> <span class=\"token operator\">&lt;</span>进程名<span class=\"token operator\">></span>\n<span class=\"token comment\">#封杀某个IP或者IP段,如:</span>\niptables -I INPUT -s <span class=\"token builtin class-name\">.</span> -j DROP\niptables -I INPUT -s ./ -j DROP\n<span class=\"token comment\">#禁止从某台主机ssh访问登陆本机</span>\niptables -t filter -A INPUT -s <span class=\"token builtin class-name\">.</span> -p tcp --dport -j DROP\n<span class=\"token comment\">#备份mysql数据库</span>\nmysqldump -u 用户名 -p 密码 数据库名 <span class=\"token operator\">></span> back.sql\nmysqldump --all-database <span class=\"token operator\">></span> bak.sql\n<span class=\"token comment\">#还原mysql数据库</span>\nmysql -u 用户名 -p 密码 数据库名 <span class=\"token operator\">&lt;</span> bak.sql\n<span class=\"token function\">find</span> / *.php -perm\n<span class=\"token function\">awk</span> -F: /etc/passwd\n<span class=\"token function\">crontab</span> -l\n<span class=\"token comment\">#检查所有的tcp连接数量和状态</span>\n<span class=\"token function\">netstat</span> -ant<span class=\"token operator\">|</span><span class=\"token function\">awk</span> <span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token operator\">|</span><span class=\"token function\">sed</span> -e -e <span class=\"token operator\">|</span><span class=\"token function\">sort</span><span class=\"token operator\">|</span><span class=\"token function\">uniq</span> -c<span class=\"token operator\">|</span><span class=\"token function\">sort</span> -rn\n<span class=\"token comment\">#查看页面访问排名前十的IP</span>\n<span class=\"token function\">cat</span> /var/log/apache2/access.log <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -f1 -d <span class=\"token operator\">|</span> <span class=\"token function\">sort</span> <span class=\"token operator\">|</span> <span class=\"token function\">uniq</span> -c <span class=\"token operator\">|</span> <span class=\"token function\">sort</span> -k -r <span class=\"token operator\">|</span> <span class=\"token function\">head</span> -\n<span class=\"token comment\">#查看页面访问排名前十的url</span>\n<span class=\"token function\">cat</span> /var/log/apache2/access.log <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -f4 -d <span class=\"token operator\">|</span> <span class=\"token function\">sort</span> <span class=\"token operator\">|</span> <span class=\"token function\">uniq</span> -c <span class=\"token operator\">|</span> <span class=\"token function\">sort</span> -k -r <span class=\"token operator\">|</span> <span class=\"token function\">head</span> -<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"权限维持\"><a href=\"#权限维持\" class=\"headerlink\" title=\"权限维持\"></a>权限维持</h2><ul>\n<li><p>种植不死马</p>\n</li>\n<li><p>反弹shell</p>\n</li>\n<li><p>信息隐藏</p>\n</li>\n</ul>\n<p>参考文章:</p>\n<p><a href=\"https://www.fuzzer.xyz/2019/04/02/AWD%E7%BA%BF%E4%B8%8B%E5%87%86%E5%A4%87%E6%8C%87%E5%8D%97/\">https://www.fuzzer.xyz/2019/04/02/AWD%E7%BA%BF%E4%B8%8B%E5%87%86%E5%A4%87%E6%8C%87%E5%8D%97/</a></p>\n<h2 id=\"防御要点\"><a href=\"#防御要点\" class=\"headerlink\" title=\"防御要点\"></a>防御要点</h2><h3 id=\"审计再审计\"><a href=\"#审计再审计\" class=\"headerlink\" title=\"审计再审计\"></a>审计再审计</h3><p>Linux日志存放路径: /var/log/</p>\n<p>Apache服务日志:</p>\n<p>/var/log/apache2/access.log</p>\n<p>/var/log/apache2/error.log</p>\n<p>查看/var/log/wtmp文件查看可疑IP登陆</p>\n<p>查看/var/log/secure 文件寻找可疑IP登陆次数</p>\n<h2 id=\"一些AWD资源\"><a href=\"#一些AWD资源\" class=\"headerlink\" title=\"一些AWD资源\"></a>一些AWD资源</h2><p><a href=\"https://neversec.top/20190415/how-to-awd.html\">https://neversec.top/20190415/how-to-awd.html</a></p>\n<p>以下内容大多来源自上面这个网址</p>\n<h3 id=\"Github资源\"><a href=\"#Github资源\" class=\"headerlink\" title=\"Github资源\"></a>Github资源</h3><ul>\n<li>(⭐235) AWD攻防赛脚本集合: <a href=\"https://github.com/admintony/Prepare-for-AWD\">https://github.com/admintony/Prepare-for-AWD</a></li>\n<li>(⭐124) Attack-Defense-Framework: <a href=\"https://github.com/SniperOJ/Attack-Defense-Framework/tree/v2\">https://github.com/SniperOJ/Attack-Defense-Framework/tree/v2</a></li>\n<li>(⭐99) AWD攻防赛webshell批量利用框架: <a href=\"https://github.com/Ares-X/AWD-Predator-Framework\">https://github.com/Ares-X/AWD-Predator-Framework</a></li>\n<li>(⭐28) awd-frame: <a href=\"https://github.com/xnianq/awd-frame\">https://github.com/xnianq/awd-frame</a></li>\n<li>(⭐4) WEB-AWD-Framework:<a href=\"https://github.com/dahua966/WEB-AWD-Framework\">https://github.com/dahua966/WEB-AWD-Framework</a></li>\n<li>(⭐0) AWD-helper: <a href=\"https://github.com/sarleon/AWD-helper\">https://github.com/sarleon/AWD-helper</a></li>\n<li>AWD线下脚本: <a href=\"https://github.com/admintony/Prepare-for-AWD\">https://github.com/admintony/Prepare-for-AWD</a></li>\n<li>提权exp: <a href=\"https://github.com/SecWiki/linux-kernel-exploits\">https://github.com/SecWiki/linux-kernel-exploits</a></li>\n</ul>\n<h3 id=\"AWD经验\"><a href=\"#AWD经验\" class=\"headerlink\" title=\"AWD经验\"></a>AWD经验</h3><ul>\n<li>CTF线下赛AWD模式下的生存技巧: <a href=\"https://www.anquanke.com/post/id/84675\">https://www.anquanke.com/post/id/84675</a></li>\n<li>CTF线下赛AWD套路小结: <a href=\"https://xz.aliyun.com/t/25\">https://xz.aliyun.com/t/25</a></li>\n<li>AWD混战攻略: <a href=\"https://www.jianshu.com/p/d21b7e1bffaf\">https://www.jianshu.com/p/d21b7e1bffaf</a></li>\n<li>CTF线下AWD攻防模式的准备工作及起手式: <a href=\"https://blog.csdn.net/like98k/article/details/80261603\">https://blog.csdn.net/like98k/article/details/80261603</a></li>\n<li>2017强网杯线下AWD攻防总结（适合新手）: <a href=\"https://www.t00ls.net/articles-42278.html\">https://www.t00ls.net/articles-42278.html</a></li>\n<li>AWD攻防线下生存之道: <a href=\"http://47.95.201.153/blog/AWD%E6%94%BB%E9%98%B2%E7%BA%BF%E4%B8%8B%E7%94%9F%E5%AD%98%E4%B9%8B%E9%81%93.html\">http://47.95.201.153/blog/AWD攻防线下生存之道.html</a></li>\n<li>CTF AWD模式攻防Note: <a href=\"https://www.cnblogs.com/nul1/p/9576386.html\">https://www.cnblogs.com/nul1/p/9576386.html</a></li>\n</ul>\n<h3 id=\"权限维持-1\"><a href=\"#权限维持-1\" class=\"headerlink\" title=\"权限维持\"></a>权限维持</h3><ul>\n<li>不死马的删除: <a href=\"https://yq.aliyun.com/zt/325638\">https://yq.aliyun.com/zt/325638</a></li>\n<li>awd攻防之kill不死马: <a href=\"https://www.jianshu.com/p/ba79686987da\">https://www.jianshu.com/p/ba79686987da</a></li>\n<li>python中的后渗透|也可用于AWD攻防–shell管理: <a href=\"https://www.jianshu.com/p/2e8e7330b73e\">https://www.jianshu.com/p/2e8e7330b73e</a></li>\n<li>从0到1掌握AWD攻防之RSA必杀: <a href=\"https://www.360zhijia.com/anquan/456324.html\">https://www.360zhijia.com/anquan/456324.html</a></li>\n<li>资深大牛教你如何web端权限维持（内附具体步骤）: <a href=\"http://www.sohu.com/a/127074604_472906\">http://www.sohu.com/a/127074604_472906</a></li>\n</ul>\n","text":"AWDAWD(Attack With Defence),一种CTF赛制 三个特点: 实战性:真实网络安全防护设备设施加入抽象的网络环境中,模拟政企典型网络结构 对抗性:一种人人对抗的竞赛方式,考验参赛团队攻防兼备. 实时性:12-48小时不等,靶机数量根据比赛而定,其实时间也是根...","link":"","photos":[],"count_time":{"symbolsCount":"3.4k","symbolsTime":"3 mins."},"categories":[{"name":"CTF","slug":"CTF","count":42,"path":"api/categories/CTF.json"}],"tags":[{"name":"CTF","slug":"CTF","count":14,"path":"api/tags/CTF.json"},{"name":"AWD","slug":"AWD","count":1,"path":"api/tags/AWD.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#AWD\"><span class=\"toc-text\">AWD</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#AWD%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">AWD环境</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#AWD%E9%A2%98%E7%9B%AE%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">AWD题目类型</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#AWD%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7\"><span class=\"toc-text\">AWD常用工具:</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%94%BB%E5%87%BB%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">攻击思路</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">常用命令</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81\"><span class=\"toc-text\">权限维持</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%98%B2%E5%BE%A1%E8%A6%81%E7%82%B9\"><span class=\"toc-text\">防御要点</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%A1%E8%AE%A1%E5%86%8D%E5%AE%A1%E8%AE%A1\"><span class=\"toc-text\">审计再审计</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E4%BA%9BAWD%E8%B5%84%E6%BA%90\"><span class=\"toc-text\">一些AWD资源</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Github%E8%B5%84%E6%BA%90\"><span class=\"toc-text\">Github资源</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#AWD%E7%BB%8F%E9%AA%8C\"><span class=\"toc-text\">AWD经验</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81-1\"><span class=\"toc-text\">权限维持</span></a></li></ol></li></ol>","author":{"name":"沐子龍","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"巅峰极客之flask","uid":"7bb41472be4b9537a699ed5c75c69f9c","slug":"巅峰极客之flask","date":"2020-09-29T15:24:55.000Z","updated":"2020-10-25T11:03:00.000Z","comments":true,"path":"api/articles/巅峰极客之flask.json","keywords":"A1andNS","cover":null,"text":"在巅峰极客杯的WEB题目中有一题flask的题目，这是一题很基础的SSTI题目，涉及的是flask框架注入 首先先登陆，随意输入大于４个字符的用户名就好了，无所谓． 然后会自动转到一个hello xxx！的页面，可以看到关键点在于这个name参数．所以我从name参数入手，通过尝...","link":"","photos":[],"count_time":{"symbolsCount":"17k","symbolsTime":"15 mins."},"categories":[{"name":"CTF","slug":"CTF","count":42,"path":"api/categories/CTF.json"}],"tags":[{"name":"CTF","slug":"CTF","count":14,"path":"api/tags/CTF.json"},{"name":"WEB","slug":"WEB","count":39,"path":"api/tags/WEB.json"},{"name":"SSTI","slug":"SSTI","count":1,"path":"api/tags/SSTI.json"},{"name":"巅峰极客杯","slug":"巅峰极客杯","count":1,"path":"api/tags/巅峰极客杯.json"}],"author":{"name":"沐子龍","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"通达OA11.7后台sql注入到RCE复现","uid":"8e117461a44b784c60f14a08fb600518","slug":"通达OA11-7后台sql注入到RCE复现","date":"2020-09-26T12:15:21.000Z","updated":"2020-09-30T04:22:08.000Z","comments":true,"path":"api/articles/通达OA11-7后台sql注入到RCE复现.json","keywords":"A1andNS","cover":[],"text":"写在最前最近的Hvv期间爆出来一个通达OA的漏洞,红队大佬们太牛了.然后在网上看到了相关的一些文章,下面就实际来复现一下 复现环境 漏洞版本:通达OA11.7 靶机系统:Winodws 7 漏洞详情这里想要看源码,和之前复现通达OA漏洞一样的,需要去找一个解码工具,才可以看到源代...","link":"","photos":[],"count_time":{"symbolsCount":"5.6k","symbolsTime":"5 mins."},"categories":[{"name":"漏洞复现","slug":"漏洞复现","count":4,"path":"api/categories/漏洞复现.json"}],"tags":[{"name":"漏洞复现","slug":"漏洞复现","count":5,"path":"api/tags/漏洞复现.json"},{"name":"漏洞分析","slug":"漏洞分析","count":3,"path":"api/tags/漏洞分析.json"},{"name":"SQL","slug":"SQL","count":2,"path":"api/tags/SQL.json"},{"name":"RCE","slug":"RCE","count":4,"path":"api/tags/RCE.json"},{"name":"代码审计","slug":"代码审计","count":2,"path":"api/tags/代码审计.json"},{"name":"通达OA","slug":"通达OA","count":2,"path":"api/tags/通达OA.json"}],"author":{"name":"沐子龍","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}